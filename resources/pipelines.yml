# Lakeflow Declarative Pipeline Configuration
resources:
  pipelines:
    customer_complaints_pipeline:
      name: "customer_complaints_r_migration_pipeline"
      catalog: ${var.catalog}
      schema: ${var.schema}
      serverless: ${var.pipeline_serverless}
      
      # All-purpose cluster configuration for development (when serverless: false)
      clusters:
        - label: "main"
          node_type_id: "i3.xlarge"  # Medium-sized instances for development work
          driver_node_type_id: "i3.xlarge"
          num_workers: 2
          spark_conf:
            "spark.databricks.cluster.profile": "serverless"
            "spark.databricks.delta.preview.enabled": "true"
          custom_tags: ${var.environment_tags}
      
      # Explicitly include each transformation file
      libraries:
        - file:
            path: ../src/pipelines/transformations/customer_complaints_bronze.sql
        - file:
            path: ../src/pipelines/transformations/customer_complaints_silver.sql
        - file:
            path: ../src/pipelines/transformations/customer_complaints_gold.sql
      
      # Configuration parameters
      configuration:
        volume_path: ${var.volume_path}
        
      # Environment settings for dependencies
      environment:
        dependencies:
          # Include any Python dependencies as YAML list if needed
          - scikit-learn

      # Notifications for pipeline failures
      notifications:
        - email_recipients:
            - daniel.zoccali@databricks.com
          alerts:
            - on-update-failure
            - on-update-fatal-failure
            - on-flow-failure


